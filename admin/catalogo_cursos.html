<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>LK Studio | Gestión de Cursos</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --gold: #D4AF37;
            --gold-bright: #FFD700;
            --deep-black: #050505;
            --sidebar-width: 280px;
        }

        body {
            background: var(--deep-black);
            color: #fff;
            font-family: 'Poppins', sans-serif;
            display: flex;
        }

        #sidebar {
            width: var(--sidebar-width);
            background: #000;
            border-right: 2px solid var(--gold);
            height: 100vh;
            position: fixed;
        }

        .nav-link {
            color: #fff !important;
            padding: 15px 25px;
            text-transform: uppercase;
            font-size: 0.8rem;
            text-decoration: none;
            display: block;
            border-bottom: 1px solid #111;
        }

        .nav-link.active {
            background: rgba(212, 175, 55, 0.1);
            border-left: 5px solid var(--gold);
            color: var(--gold-bright) !important;
        }

        #content {
            margin-left: var(--sidebar-width);
            width: calc(100% - var(--sidebar-width));
            padding: 40px;
        }

        .luxury-font { font-family: 'Cinzel', serif; color: var(--gold); }

        .curso-card {
            background: #111;
            border: 1px solid #333;
            border-radius: 15px;
            overflow: hidden;
            transition: 0.3s;
            height: 100%;
        }

        .curso-card:hover {
            border-color: var(--gold);
            transform: translateY(-5px);
        }

        .curso-img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-bottom: 2px solid var(--gold);
        }

        .badge-categoria {
            background: var(--gold);
            color: #000;
            font-size: 0.6rem;
            padding: 3px 8px;
            border-radius: 5px;
            font-weight: bold;
        }

        .modal-content {
            background: #111;
            border: 2px solid var(--gold);
            color: #fff;
        }

        .form-control, .form-select {
            background: #000 !important;
            border: 1px solid #333 !important;
            color: #fff !important;
        }

        /* Botón añadir categoría */
        .btn-add-cat {
            background: var(--gold);
            color: #000;
            border: none;
            border-radius: 0 5px 5px 0;
            padding: 0 15px;
        }
    </style>
</head>
<body>

<nav id="sidebar">
    <div style="padding: 30px; text-align: center;">
        <img src="IMG/LKSTUDIO.png" alt="Logo" style="width: 120px;">
    </div>
    <div class="mt-3">
        <a href="PANEL_ADMIN.html" class="nav-link"><i class="fas fa-chart-line me-2"></i> Dashboard</a>
        <a href="catalogo_cursos.html" class="nav-link active"><i class="fas fa-graduation-cap me-2"></i> Cursos</a>
        <a href="catalogo_instruc.html" class="nav-link"><i class="fas fa-user-tie me-2"></i> Instructores</a>
        <a href="catalogo_servicios.html" class="nav-link"><i class="fas fa-magic me-2"></i> Servicios</a>
    </div>
</nav>

<div id="content">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h2 class="luxury-font mb-0">CATÁLOGO DE CURSOS</h2>
            <p class="text-white-50 small">Administra tu oferta académica</p>
        </div>
        <button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#modalCurso" onclick="nuevoCurso()">
            <i class="fas fa-plus me-2"></i> AGREGAR CURSO
        </button>
    </div>

    <div class="row g-4" id="gridCursos"></div>
</div>

<div class="modal fade" id="modalCurso" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="luxury-font">EXPEDIENTE DE CURSO</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form id="formCurso">
                <div class="modal-body">
                    <input type="hidden" id="editIndex" value="-1">
                    <div class="row g-3">
                        <div class="col-md-8">
                            <label class="small mb-1 text-warning">NOMBRE DEL CURSO</label>
                            <input type="text" id="nombre" class="form-control" required>
                        </div>
                        <div class="col-md-4">
                            <label class="small mb-1 text-warning">CATEGORÍA</label>
                            <div class="input-group">
                                <select id="categoria" class="form-select"></select>
                                <button type="button" class="btn-add-cat" onclick="agregarNuevaCategoria()">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="small mb-1 text-warning">INSTRUCTOR ASIGNADO</label>
                            <select id="instructorSelect" class="form-select" required></select>
                        </div>
                        <div class="col-md-3">
                            <label class="small mb-1 text-warning">PRECIO ($)</label>
                            <input type="number" id="precio" class="form-control" required>
                        </div>
                        <div class="col-md-3">
                            <label class="small mb-1 text-warning">DURACIÓN</label>
                            <input type="text" id="duracion" class="form-control">
                        </div>
                        <div class="col-12">
                            <label class="small mb-1 text-warning">PORTADA (IMAGEN)</label>
                            <input type="file" id="fotoInput" class="form-control" accept="image/*">
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="submit" class="btn btn-warning w-100 fw-bold">GUARDAR CURSO</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    let cursos = JSON.parse(localStorage.getItem("LK_CURSOS")) || [];
    // Cargar categorías iniciales o las guardadas
    let categorias = JSON.parse(localStorage.getItem("LK_CATEGORIAS")) || ["CEJAS", "PESTAÑAS", "UÑAS", "BARBERÍA"];
    let base64Image = "";

    // --- LÓGICA DE CATEGORÍAS DINÁMICAS ---
    function cargarCategorias() {
        const select = document.getElementById("categoria");
        select.innerHTML = categorias.map(cat => `<option value="${cat}">${cat}</option>`).join('');
    }

    function agregarNuevaCategoria() {
        const nuevaCat = prompt("Ingrese el nombre de la nueva categoría:").toUpperCase();
        if (nuevaCat && !categorias.includes(nuevaCat)) {
            categorias.push(nuevaCat);
            localStorage.setItem("LK_CATEGORIAS", JSON.stringify(categorias));
            cargarCategorias(); // Recargar el select
            document.getElementById("categoria").value = nuevaCat; // Seleccionar la nueva
        } else if (categorias.includes(nuevaCat)) {
            alert("La categoría ya existe.");
        }
    }

    // --- RESTO DE FUNCIONES ---
    function cargarInstructoresParaSelect() {
        const instructores = JSON.parse(localStorage.getItem("LK_INSTRUCTORES_MASTER")) || [];
        const select = document.getElementById("instructorSelect");
        if (instructores.length === 0) {
            select.innerHTML = '<option value="">SIN INSTRUCTORES</option>';
        } else {
            select.innerHTML = instructores.map(i => `<option value="${i.nombre}">${i.nombre}</option>`).join('');
        }
    }

    document.getElementById('fotoInput').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = function() { base64Image = reader.result; };
        reader.readAsDataURL(e.target.files[0]);
    });

    function nuevoCurso() {
        document.getElementById('formCurso').reset();
        document.getElementById('editIndex').value = "-1";
        base64Image = "";
        cargarCategorias();
        cargarInstructoresParaSelect();
    }

    document.getElementById('formCurso').onsubmit = function(e) {
        e.preventDefault();
        const idx = parseInt(document.getElementById('editIndex').value);
        const curso = {
            nombre: document.getElementById('nombre').value.toUpperCase(),
            categoria: document.getElementById('categoria').value,
            instructor: document.getElementById('instructorSelect').value,
            precio: document.getElementById('precio').value,
            duracion: document.getElementById('duracion').value,
            foto: base64Image || (idx > -1 ? cursos[idx].foto : "https://via.placeholder.com/300x180?text=LK+STUDIO")
        };
        if(idx === -1) cursos.push(curso);
        else cursos[idx] = curso;
        localStorage.setItem("LK_CURSOS", JSON.stringify(cursos));
        bootstrap.Modal.getInstance(document.getElementById('modalCurso')).hide();
        renderCursos();
    };

    function renderCursos() {
        const grid = document.getElementById('gridCursos');
        grid.innerHTML = "";
        cursos.forEach((c, i) => {
            grid.innerHTML += `
                <div class="col-md-4 col-lg-3">
                    <div class="curso-card animate__animated animate__fadeIn">
                        <img src="${c.foto}" class="curso-img">
                        <div class="p-3">
                            <span class="badge-categoria mb-2">${c.categoria}</span>
                            <h6 class="mb-1 text-gold">${c.nombre}</h6>
                            <p class="small text-white-50 mb-2"><i class="fas fa-user-tie me-1"></i> ${c.instructor}</p>
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <span class="fw-bold">$${c.precio}</span>
                                <div>
                                    <button class="btn btn-sm btn-outline-light" onclick="prepararEdit(${i})"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="eliminarCurso(${i})"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
        });
    }

    function prepararEdit(i) {
        const c = cursos[i];
        nuevoCurso();
        document.getElementById('editIndex').value = i;
        document.getElementById('nombre').value = c.nombre;
        document.getElementById('categoria').value = c.categoria;
        document.getElementById('precio').value = c.precio;
        document.getElementById('duracion').value = c.duracion;
        base64Image = c.foto;
        bootstrap.Modal.getOrCreateInstance(document.getElementById('modalCurso')).show();
    }

    function eliminarCurso(i) {
        if(confirm("¿Eliminar curso?")) {
            cursos.splice(i, 1);
            localStorage.setItem("LK_CURSOS", JSON.stringify(cursos));
            renderCursos();
        }
    }

    renderCursos();
</script>
</body>
</html>
