<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>LK Studio | Expediente Maestro de Instructores</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --gold: #D4AF37;
            --gold-bright: #FFD700;
            --rose: #E6B8A2;
            --deep-black: #050505;
            --grey-row: #161616; 
            --white-text: #FFFFFF;
            --sidebar-width: 280px;
        }

        body {
            background: var(--deep-black);
            color: var(--white-text);
            font-family: 'Poppins', sans-serif;
            margin: 0;
            display: flex;
            min-height: 100vh;
        }

        /* --- SIDEBAR --- */
        #sidebar {
            width: var(--sidebar-width);
            background: #000;
            border-right: 2px solid var(--gold);
            height: 100vh;
            position: fixed;
            z-index: 1000;
        }

        .sidebar-logo { padding: 30px; text-align: center; border-bottom: 1px solid #222; }
        .sidebar-logo img { width: 140px; filter: drop-shadow(0 0 5px var(--gold)); }

        .nav-link {
            color: #fff !important;
            padding: 15px 25px;
            font-size: 0.85rem;
            text-transform: uppercase;
            transition: 0.3s;
            border-bottom: 1px solid #111;
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .nav-link i { width: 30px; color: var(--gold-bright); }
        .nav-link:hover, .nav-link.active {
            background: rgba(212, 175, 55, 0.1);
            border-left: 5px solid var(--gold);
            color: var(--gold-bright) !important;
        }

        /* --- CONTENIDO --- */
        #content {
            width: calc(100% - var(--sidebar-width));
            margin-left: var(--sidebar-width);
            padding: 40px;
        }

        .luxury-font { font-family: 'Cinzel', serif; color: var(--gold); letter-spacing: 2px; }

        .card-form {
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .section-title {
            color: var(--gold);
            font-weight: 800;
            font-size: 0.75rem;
            border-left: 3px solid var(--gold);
            padding-left: 12px;
            margin: 20px 0 15px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* --- TABLA --- */
        .table-custom { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
        .table-custom thead th { color: var(--rose); text-transform: uppercase; letter-spacing: 1px; border: none; font-size: 0.7rem; padding: 10px; }
        .table-custom tbody tr { background: var(--grey-row) !important; transition: 0.3s; }
        .table-custom td { padding: 15px !important; color: #fff !important; border: none; vertical-align: middle; font-size: 0.85rem; }
        .table-custom tr td:first-child { border-radius: 10px 0 0 10px; border-left: 4px solid var(--gold); }
        .table-custom tr td:last-child { border-radius: 0 10px 10px 0; }

        /* INPUTS */
        .form-label { color: var(--rose); font-size: 0.7rem; font-weight: 600; margin-bottom: 5px; }
        .form-control, .form-select {
            background: #000 !important;
            border: 1px solid #222 !important;
            color: #fff !important;
            border-radius: 8px;
            padding: 10px;
            font-size: 0.85rem;
        }
        .form-control:focus { border-color: var(--gold); box-shadow: 0 0 0 0.25rem rgba(212, 175, 55, 0.1); }

        .btn-gold {
            background: linear-gradient(45deg, #b38f1d, var(--gold-bright));
            color: #000; font-weight: 800; border-radius: 50px;
            border: none; padding: 12px; transition: 0.3s;
            text-transform: uppercase; letter-spacing: 1px;
            font-size: 0.8rem;
        }
        .btn-gold:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3); }

        .doc-icon { font-size: 1rem; margin-right: 5px; transition: 0.3s; cursor: pointer; }
        .doc-active { color: var(--gold-bright); }
        .doc-inactive { color: #222; }

        .scroll-form { max-height: 80vh; overflow-y: auto; padding-right: 10px; }
    </style>
</head>

<body>

<nav id="sidebar">
    <div class="sidebar-logo">
        <img src="IMG/LKSTUDIO.png" alt="Logo">
    </div>
    <div class="mt-4">
        <a href="PANEL_ADMIN.html" class="nav-link"><i class="fas fa-chart-line"></i> Dashboard</a>
        <a href="catalogo_cursos.html" class="nav-link"><i class="fas fa-graduation-cap"></i> Cursos</a>
        <a href="#" class="nav-link active"><i class="fas fa-user-tie"></i> Instructores</a>
        <a href="catalogo_beneficios.html" class="nav-link"><i class="fas fa-gem"></i> Beneficios</a>
    </div>
</nav>

<div id="content">
    <div class="d-flex justify-content-between align-items-end mb-4">
        <div>
            <h2 class="luxury-font mb-1">REGISTRO DE INSTRUCTORES</h2>
            <p class="text-white-50 small mb-0">Expediente Legal: ICATEP / SEP / Diploma de Especialidad</p>
        </div>
        <div class="text-end">
            <span class="text-rose small fw-bold">TOTAL REGISTRADOS: </span>
            <h3 class="luxury-font mb-0" id="totalCount">0</h3>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-xl-5">
            <div class="card-form animate__animated animate__fadeInLeft">
                <form id="formInstructor" class="scroll-form">
                    <input type="hidden" id="editIndex" value="-1">
                    
                    <div class="section-title" style="margin-top: 0;">1. Identificación y RFC</div>
                    <div class="mb-3">
                        <label class="form-label">NOMBRE COMPLETO (Como aparece en Acta)</label>
                        <input type="text" id="nombre" class="form-control" required oninput="this.value = this.value.toUpperCase()">
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">CURP (Vigencia < 3 meses)</label>
                            <input type="text" id="curp" class="form-control" maxlength="18" placeholder="18 caracteres" oninput="this.value = this.value.toUpperCase()">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label d-flex justify-content-between">
                                RFC <span class="text-gold" style="cursor:pointer; font-size: 0.6rem;" onclick="generarRFC()">
                                    <i class="fas fa-magic"></i> GENERAR DESDE CURP
                                </span>
                            </label>
                            <input type="text" id="rfc" class="form-control" maxlength="13" placeholder="RFC con Homoclave" oninput="this.value = this.value.toUpperCase()">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">¿ES MENOR DE EDAD? (15-17 AÑOS)</label>
                        <select id="esMenor" class="form-select" onchange="toggleMenor()">
                            <option value="no">No, es mayor de edad</option>
                            <option value="si">Sí, requiere tutor</option>
                        </select>
                    </div>

                    <div class="section-title">2. Documentación General (Copias)</div>
                    <div class="row g-2">
                        <div class="col-12 mb-2">
                            <label class="form-label">1. INE o PASAPORTE VIGENTE</label>
                            <input type="file" id="f_ine" class="form-control form-control-sm">
                        </div>
                        <div class="col-md-6 mb-2">
                            <label class="form-label">2. ACTA DE NACIMIENTO</label>
                            <input type="file" id="f_acta" class="form-control form-control-sm">
                        </div>
                        <div class="col-md-6 mb-2">
                            <label class="form-label">3. CURP ACTUALIZADA</label>
                            <input type="file" id="f_curp" class="form-control form-control-sm">
                        </div>
                        <div class="col-md-6 mb-2">
                            <label class="form-label">4. COMP. DOMICILIO</label>
                            <input type="file" id="f_domicilio" class="form-control form-control-sm">
                        </div>
                        <div class="col-md-6 mb-2">
                            <label class="form-label">5. ÚLTIMO GRADO ESTUDIOS</label>
                            <input type="file" id="f_estudios" class="form-control form-control-sm">
                        </div>
                    </div>

                    <div id="seccionTutor" style="display:none;" class="mt-2 p-3 border border-warning rounded">
                        <div class="text-warning mb-2 small fw-bold">6. REQUISITO PARA MENORES</div>
                        <label class="form-label">INE DEL PADRE, MADRE O TUTOR</label>
                        <input type="file" id="f_tutor" class="form-control form-control-sm">
                    </div>

                    <div class="section-title">3. Trámite Diploma Especialidad</div>
                    <div class="row g-2">
                        <div class="col-md-6 mb-2">
                            <label class="form-label">7. FOTO ÓVALO MIGNON (B/N)</label>
                            <input type="file" id="f_foto" class="form-control form-control-sm">
                        </div>
                        <div class="col-md-6 mb-2">
                            <label class="form-label">8. DIPLOMAS PREVIOS (PDF)</label>
                            <input type="file" id="f_diplomas" class="form-control form-control-sm">
                        </div>
                    </div>

                    <div class="mt-4">
                        <button type="submit" class="btn btn-gold w-100" id="btnSubmit">
                            <i class="fas fa-save me-2"></i> GUARDAR EN BASE DE DATOS
                        </button>
                        <button type="button" class="btn btn-outline-light w-100 mt-2 btn-sm" onclick="resetForm()" id="btnCancel" style="display:none;">CANCELAR EDICIÓN</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="col-xl-7">
            <div class="table-responsive">
                <table class="table-custom">
                    <thead>
                        <tr>
                            <th>INSTRUCTOR</th>
                            <th class="text-center">CHECKLIST EXPEDIENTE</th>
                            <th class="text-end">ACCIONES</th>
                        </tr>
                    </thead>
                    <tbody id="tablaInstructores"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
// Base de datos sincronizada
let instructores = JSON.parse(localStorage.getItem("LK_INSTRUCTORES_MASTER")) || [];

function generarRFC() {
    const curp = document.getElementById("curp").value.trim();
    if (curp.length >= 10) {
        const homoclave = (curp.length === 18) ? curp.substring(15, 18) : "XX1";
        document.getElementById("rfc").value = curp.substring(0, 10) + homoclave;
    } else { alert("Ingresa primero el CURP (al menos 10 caracteres)."); }
}

function toggleMenor() {
    document.getElementById("seccionTutor").style.display = (document.getElementById("esMenor").value === "si") ? "block" : "none";
}

const toBase64 = file => new Promise((resolve) => {
    if(!file) resolve(null);
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => resolve(reader.result);
});

// CRUD: GUARDAR / EDITAR
document.getElementById("formInstructor").onsubmit = async function(e) {
    e.preventDefault();
    const idx = parseInt(document.getElementById("editIndex").value);
    
    const instructor = {
        nombre: document.getElementById("nombre").value.toUpperCase(),
        curp: document.getElementById("curp").value.toUpperCase(),
        rfc: document.getElementById("rfc").value.toUpperCase(),
        menor: document.getElementById("esMenor").value,
        docs: {
            ine: await toBase64(document.getElementById("f_ine").files[0]) || (idx > -1 ? instructores[idx].docs.ine : null),
            acta: await toBase64(document.getElementById("f_acta").files[0]) || (idx > -1 ? instructores[idx].docs.acta : null),
            curp_doc: await toBase64(document.getElementById("f_curp").files[0]) || (idx > -1 ? instructores[idx].docs.curp_doc : null),
            domicilio: await toBase64(document.getElementById("f_domicilio").files[0]) || (idx > -1 ? instructores[idx].docs.domicilio : null),
            estudios: await toBase64(document.getElementById("f_estudios").files[0]) || (idx > -1 ? instructores[idx].docs.estudios : null),
            tutor: await toBase64(document.getElementById("f_tutor").files[0]) || (idx > -1 ? instructores[idx].docs.tutor : null),
            foto: await toBase64(document.getElementById("f_foto").files[0]) || (idx > -1 ? instructores[idx].docs.foto : null),
            diplomas: await toBase64(document.getElementById("f_diplomas").files[0]) || (idx > -1 ? instructores[idx].docs.diplomas : null)
        }
    };

    if(idx === -1) instructores.push(instructor);
    else instructores[idx] = instructor;

    localStorage.setItem("LK_INSTRUCTORES_MASTER", JSON.stringify(instructores));
    resetForm();
    renderTable();
};

function renderTable() {
    const tbody = document.getElementById("tablaInstructores");
    document.getElementById("totalCount").innerText = instructores.length;
    tbody.innerHTML = "";

    instructores.forEach((inst, i) => {
        tbody.innerHTML += `
            <tr class="animate__animated animate__fadeIn">
                <td>
                    <div class="fw-bold text-white">${inst.nombre}</div>
                    <div class="text-rose small" style="font-size:0.7rem">${inst.rfc} | ${inst.curp}</div>
                </td>
                <td class="text-center">
                    <i class="fas fa-id-card doc-icon ${inst.docs.ine ? 'doc-active' : 'doc-inactive'}" title="INE" onclick="verDoc('${inst.docs.ine}')"></i>
                    <i class="fas fa-baby doc-icon ${inst.docs.acta ? 'doc-active' : 'doc-inactive'}" title="Acta" onclick="verDoc('${inst.docs.acta}')"></i>
                    <i class="fas fa-home doc-icon ${inst.docs.domicilio ? 'doc-active' : 'doc-inactive'}" title="Domicilio" onclick="verDoc('${inst.docs.domicilio}')"></i>
                    <i class="fas fa-graduation-cap doc-icon ${inst.docs.estudios ? 'doc-active' : 'doc-inactive'}" title="Estudios" onclick="verDoc('${inst.docs.estudios}')"></i>
                    <i class="fas fa-camera doc-icon ${inst.docs.foto ? 'doc-active' : 'doc-inactive'}" title="Foto Mignon" onclick="verDoc('${inst.docs.foto}')"></i>
                </td>
                <td class="text-end">
                    <button class="btn btn-link text-gold p-1" onclick="prepararEdit(${i})"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-link text-danger p-1" onclick="eliminar(${i})"><i class="fas fa-trash-alt"></i></button>
                </td>
            </tr>
        `;
    });
}

function prepararEdit(i) {
    const inst = instructores[i];
    document.getElementById("editIndex").value = i;
    document.getElementById("nombre").value = inst.nombre;
    document.getElementById("curp").value = inst.curp;
    document.getElementById("rfc").value = inst.rfc;
    document.getElementById("esMenor").value = inst.menor;
    document.getElementById("btnSubmit").innerText = "ACTUALIZAR DATOS";
    document.getElementById("btnCancel").style.display = "block";
    toggleMenor();
}

function eliminar(i) {
    if(confirm("¿Eliminar expediente de " + instructores[i].nombre + "?")) {
        instructores.splice(i, 1);
        localStorage.setItem("LK_INSTRUCTORES_MASTER", JSON.stringify(instructores));
        renderTable();
    }
}

function resetForm() {
    document.getElementById("formInstructor").reset();
    document.getElementById("editIndex").value = "-1";
    document.getElementById("btnSubmit").innerHTML = '<i class="fas fa-save me-2"></i> GUARDAR EN BASE DE DATOS';
    document.getElementById("btnCancel").style.display = "none";
    toggleMenor();
}

function verDoc(b64) {
    if(!b64) return alert("No se cargó este documento.");
    const win = window.open();
    win.document.write(`<iframe src="${b64}" frameborder="0" style="width:100%; height:100%;"></iframe>`);
}

renderTable();
</script>
</body>
</html>
