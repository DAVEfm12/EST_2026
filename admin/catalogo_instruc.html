<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>LK Studio | Gestión Maestra e Instructores por Curso</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --gold: #D4AF37;
            --gold-bright: #FFD700;
            --rose: #E6B8A2;
            --deep-black: #050505;
            --grey-row: #161616; 
            --white-text: #FFFFFF;
            --sidebar-width: 280px;
        }

        body {
            background: var(--deep-black);
            color: var(--white-text);
            font-family: 'Poppins', sans-serif;
            margin: 0;
            display: flex;
            min-height: 100vh;
        }

        /* --- SIDEBAR --- */
        #sidebar {
            width: var(--sidebar-width);
            background: #000;
            border-right: 2px solid var(--gold);
            height: 100vh;
            position: fixed;
            z-index: 1000;
        }

        .sidebar-logo { padding: 30px; text-align: center; border-bottom: 1px solid #222; }
        .sidebar-logo img { width: 140px; filter: drop-shadow(0 0 5px var(--gold)); }

        .nav-link {
            color: #fff !important; padding: 15px 25px; font-size: 0.85rem;
            text-transform: uppercase; transition: 0.3s; border-bottom: 1px solid #111;
            text-decoration: none; display: flex; align-items: center;
        }

        .nav-link i { width: 30px; color: var(--gold-bright); }
        .nav-link:hover, .nav-link.active {
            background: rgba(212, 175, 55, 0.1); border-left: 5px solid var(--gold);
            color: var(--gold-bright) !important;
        }

        /* --- CONTENIDO --- */
        #content {
            width: calc(100% - var(--sidebar-width));
            margin-left: var(--sidebar-width);
            padding: 40px;
        }

        .luxury-font { font-family: 'Cinzel', serif; color: var(--gold); letter-spacing: 2px; }

        /* CARDS Y TABLAS */
        .card-form {
            background: #0f0f0f; border: 1px solid #333;
            border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .section-title {
            color: var(--gold); font-weight: 800; font-size: 0.75rem;
            border-left: 3px solid var(--gold); padding-left: 12px;
            margin: 20px 0 15px 0; text-transform: uppercase;
        }

        .table-custom { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
        .table-custom thead th { color: var(--rose); text-transform: uppercase; font-size: 0.7rem; padding: 10px; }
        .table-custom tbody tr { background: var(--grey-row) !important; }
        .table-custom td { padding: 15px !important; color: #fff !important; vertical-align: middle; font-size: 0.85rem; border: none; }
        .table-custom tr td:first-child { border-radius: 10px 0 0 10px; border-left: 4px solid var(--gold); }
        .table-custom tr td:last-child { border-radius: 0 10px 10px 0; }

        /* BADGES */
        .badge-instructor {
            background: rgba(212, 175, 55, 0.15);
            border: 1px solid var(--gold);
            color: var(--gold-bright);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            margin-right: 5px;
            display: inline-block;
        }

        .form-control, .form-select {
            background: #000 !important; border: 1px solid #222 !important;
            color: #fff !important; border-radius: 8px; font-size: 0.85rem;
        }

        .btn-gold {
            background: linear-gradient(45deg, #b38f1d, var(--gold-bright));
            color: #000; font-weight: 800; border-radius: 50px; border: none; padding: 12px;
        }

        .doc-icon { font-size: 1rem; margin-right: 5px; cursor: pointer; }
        .doc-active { color: var(--gold-bright); }
        .doc-inactive { color: #222; }
    </style>
</head>

<body>

<nav id="sidebar">
    <div class="sidebar-logo"><img src="IMG/LKSTUDIO.png" alt="Logo"></div>
    <div class="mt-4">
        <a href="#" class="nav-link"><i class="fas fa-chart-line"></i> Dashboard</a>
        <a href="#seccionCursos" class="nav-link"><i class="fas fa-graduation-cap"></i> Cursos e Instructores</a>
        <a href="#" class="nav-link active"><i class="fas fa-user-tie"></i> Expedientes</a>
    </div>
</nav>

<div id="content">
    <h2 class="luxury-font mb-4">SISTEMA DE EXPEDIENTES Y ASIGNACIÓN</h2>

    <div class="row g-4">
        <div class="col-xl-4">
            <div class="card-form">
                <form id="formInstructor">
                    <input type="hidden" id="editIndex" value="-1">
                    <div class="section-title">Datos del Instructor</div>
                    
                    <div class="mb-3">
                        <label class="form-label small">NOMBRE COMPLETO</label>
                        <input type="text" id="nombre" class="form-control" required oninput="this.value = this.value.toUpperCase()">
                    </div>

                    <div class="row">
                        <div class="col-6 mb-3">
                            <label class="form-label small">CURP</label>
                            <input type="text" id="curp" class="form-control" maxlength="18" oninput="this.value = this.value.toUpperCase()">
                        </div>
                        <div class="col-6 mb-3">
                            <label class="form-label small d-flex justify-content-between">
                                RFC <span class="text-gold" style="cursor:pointer" onclick="generarRFC()"> AUTO</span>
                            </label>
                            <input type="text" id="rfc" class="form-control" maxlength="13" oninput="this.value = this.value.toUpperCase()">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label small">ASIGNAR A CURSOS</label>
                        <select id="cursosAsignados" class="form-select" multiple style="height: 100px;"></select>
                    </div>

                    <button type="submit" class="btn btn-gold w-100" id="btnSubmit">GUARDAR EXPEDIENTE</button>
                </form>
            </div>
        </div>

        <div class="col-xl-8">
            <div class="table-responsive">
                <table class="table-custom">
                    <thead>
                        <tr>
                            <th>INSTRUCTOR</th>
                            <th>RFC / CURP</th>
                            <th>CURSOS ACTIVOS</th>
                            <th class="text-end">ACCIONES</th>
                        </tr>
                    </thead>
                    <tbody id="tablaInstructores"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="mt-5" id="seccionCursos">
        <h3 class="luxury-font text-gold"><i class="fas fa-graduation-cap me-2"></i>ESTATUS DE CURSOS (Instructores Reflejados)</h3>
        <hr style="border-color: var(--gold);">
        <div class="row" id="contenedorCursosCards">
            </div>
    </div>
</div>

<script>
// Datos simulados o de LocalStorage
let cursosBase = JSON.parse(localStorage.getItem('LK_CURSOS_DATA')) || [
    {id: 1, nombre: "Microblading Profesional"},
    {id: 2, nombre: "Extensión de Pestañas"},
    {id: 3, nombre: "Maquillaje Editorial"}
];
let instructores = JSON.parse(localStorage.getItem("lk_expedientes_v4")) || [];

// 1. Generar RFC desde CURP
function generarRFC() {
    const curp = document.getElementById("curp").value;
    if(curp.length >= 10) {
        const hc = curp.length === 18 ? curp.substring(15,18) : "XX1";
        document.getElementById("rfc").value = curp.substring(0,10) + hc;
    }
}

// 2. CRUD: Guardar / Actualizar
document.getElementById("formInstructor").onsubmit = function(e) {
    e.preventDefault();
    const index = parseInt(document.getElementById("editIndex").value);
    
    const instructor = {
        nombre: document.getElementById("nombre").value.toUpperCase(),
        curp: document.getElementById("curp").value,
        rfc: document.getElementById("rfc").value,
        cursos: Array.from(document.getElementById("cursosAsignados").selectedOptions).map(o => o.value)
    };

    if(index === -1) instructores.push(instructor);
    else instructores[index] = instructor;

    localStorage.setItem("lk_expedientes_v4", JSON.stringify(instructores));
    this.reset();
    document.getElementById("editIndex").value = "-1";
    renderTodo();
};

// 3. RENDER: Reflejar nombres en Cursos y Tabla
function renderTodo() {
    // Render Tabla Expedientes
    const tbody = document.getElementById("tablaInstructores");
    tbody.innerHTML = "";
    instructores.forEach((inst, idx) => {
        tbody.innerHTML += `
            <tr>
                <td class="fw-bold">${inst.nombre}</td>
                <td class="small text-white-50">${inst.rfc}<br>${inst.curp}</td>
                <td>${inst.cursos.map(c => `<span class="badge-instructor">${c}</span>`).join('')}</td>
                <td class="text-end">
                    <button class="btn btn-link text-gold" onclick="prepararEdit(${idx})"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-link text-danger" onclick="eliminar(${idx})"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
        `;
    });

    // RENDER REFLEJO: Cursos con sus Instructores
    const contenedorCursos = document.getElementById("contenedorCursosCards");
    contenedorCursos.innerHTML = "";

    cursosBase.forEach(curso => {
        // Buscamos qué instructores tienen este curso asignado
        const instructoresAsignados = instructores.filter(inst => inst.cursos.includes(curso.nombre));
        
        contenedorCursos.innerHTML += `
            <div class="col-md-4 mb-3">
                <div class="card-form border-gold" style="min-height: 150px; border: 1px solid #333">
                    <h6 class="text-gold fw-bold">${curso.nombre}</h6>
                    <p class="small text-white-50 mb-2">Instructores asignados:</p>
                    <div>
                        ${instructoresAsignados.length > 0 
                            ? instructoresAsignados.map(i => `<div class="text-white small"><i class="fas fa-check-circle text-success me-1"></i> ${i.nombre}</div>`).join('')
                            : '<span class="text-muted small italic">Sin instructor asignado</span>'}
                    </div>
                </div>
            </div>
        `;
    });
}

function prepararEdit(idx) {
    const inst = instructores[idx];
    document.getElementById("editIndex").value = idx;
    document.getElementById("nombre").value = inst.nombre;
    document.getElementById("curp").value = inst.curp;
    document.getElementById("rfc").value = inst.rfc;
    const select = document.getElementById("cursosAsignados");
    Array.from(select.options).forEach(opt => opt.selected = inst.cursos.includes(opt.value));
    document.getElementById("btnSubmit").innerText = "ACTUALIZAR DATOS";
}

function eliminar(idx) {
    if(confirm("¿Eliminar expediente?")) {
        instructores.splice(idx, 1);
        localStorage.setItem("lk_expedientes_v4", JSON.stringify(instructores));
        renderTodo();
    }
}

// Inicializar Select
document.getElementById("cursosAsignados").innerHTML = cursosBase.map(c => `<option value="${c.nombre}">${c.nombre}</option>`).join('');
renderTodo();
</script>

</body>
</html>
