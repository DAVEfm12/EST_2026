<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>POS Elite Pro | LK Studio</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        :root { 
            --gold: #D4AF37; 
            --gold-bright: #FFD700; 
            --rose-gold: #E6B8A2; 
            --deep-black: #050505;
            --sidebar-width: 250px;
        }

        body { 
            background: radial-gradient(circle at top, #1a1a1a, var(--deep-black)); 
            color: #ffffff; 
            font-family: 'Poppins', sans-serif; 
            min-height: 100vh;
            margin: 0;
            display: flex;
        }

        /* --- SIDEBAR --- */
        #sidebar {
            width: var(--sidebar-width);
            background: rgba(0, 0, 0, 0.95);
            border-right: 1px solid var(--gold);
            height: 100vh;
            position: fixed;
            transition: all 0.3s;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }

        .nav-link {
            color: #fff !important;
            padding: 15px 25px;
            display: flex;
            align-items: center;
            transition: 0.3s;
            border-left: 3px solid transparent;
            font-size: 0.9rem;
            text-decoration: none;
        }

        .nav-link i { margin-right: 15px; width: 20px; text-align: center; color: var(--gold); }

        .nav-link:hover, .nav-link.active {
            background: rgba(212, 175, 55, 0.1);
            border-left: 3px solid var(--gold);
            color: var(--gold-bright) !important;
        }

        /* --- CONTENIDO --- */
        #content {
            width: calc(100% - var(--sidebar-width));
            margin-left: var(--sidebar-width);
            padding: 30px;
            transition: all 0.3s;
        }

        .card { 
            background: rgba(10, 10, 10, 0.9); 
            border: 1px solid var(--gold); 
            border-radius: 1.5rem; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }

        .gold { color: var(--gold) !important; }
        .golden-rose { color: var(--rose-gold) !important; }
        label { color: var(--rose-gold) !important; letter-spacing: 1px; margin-bottom: 5px; font-size: 0.8rem; font-weight: bold; }

        .btn-gold { 
            background: linear-gradient(45deg, var(--gold), #f3cf58); 
            color: #000 !important; 
            font-weight: 800; 
            border: none; 
            border-radius: 10px; 
            text-transform: uppercase;
        }

        .form-control, .form-select { 
            background: #000 !important; 
            border: 1px solid #444 !important; 
            color: #ffffff !important; 
        }

        .bg-calculadora {
            background: #0b0b0b;
            border: 1px dashed var(--gold);
            padding: 15px;
            border-radius: 15px;
        }

        .historial-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #333;
            transition: 0.3s;
            cursor: pointer;
        }
        .historial-item:hover { border-color: var(--gold); background: rgba(212, 175, 55, 0.1); }

        .badge-servicio { background: var(--gold); color: black; }
        .badge-extra { background: var(--rose-gold); color: black; }

        /* Modal Ticket Style */
        .ticket-modal {
            background: #fff;
            color: #000;
            font-family: 'Courier New', Courier, monospace;
            padding: 20px;
        }

        @media (max-width: 992px) {
            #sidebar { margin-left: calc(var(--sidebar-width) * -1); }
            #content { width: 100%; margin-left: 0; }
        }
    </style>
</head>
<body>

    <nav id="sidebar">
        <div class="sidebar-header">
            <h4 class="gold fw-bold mb-0">LK STUDIO</h4>
            <small class="golden-rose">SISTEMA ELITE</small>
        </div>
        <div class="mt-4">
            <a href="#" class="nav-link active"><i class="fas fa-cash-register"></i> VENTAS (POS)</a>
            <a href="catalogo_servicios.html" class="nav-link"><i class="fas fa-list"></i> SERVICIOS</a>
            <a href="catalogo_cursos.html" class="nav-link"><i class="fas fa-graduation-cap"></i> CURSOS</a>
            <a href="#" class="nav-link"><i class="fas fa-users"></i> CLIENTAS</a>
            <a href="#" class="nav-link" onclick="verCorteCaja()"><i class="fas fa-chart-line"></i> CORTE DE CAJA</a>
            <a href="PANEL_ADMIN.html" class="nav-link"><i class="fas fa-user-shield"></i> PANEL ADMIN</a>
        </div>
    </nav>

    <div id="content">
        <div class="container-fluid">
            <div class="row mb-4 align-items-center">
                <div class="col-md-6">
                    <h2 class="gold fw-bold m-0 animate__animated animate__fadeInDown">TERMINAL DE COBRO</h2>
                    <span id="fecha-actual" class="badge border border-warning gold p-2 mt-2"></span>
                </div>
                <div class="col-md-3">
                    <div class="card p-2 text-center border-secondary">
                        <small class="golden-rose">CAJA HOY</small>
                        <h4 class="gold m-0" id="cajaHoy">$0.00</h4>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card p-2 text-center border-secondary">
                        <small class="golden-rose">VENTAS REALIZADAS</small>
                        <h4 class="gold m-0" id="numVentas">0</h4>
                    </div>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-xl-4">
                    <div class="card p-4 animate__animated animate__fadeInLeft">
                        <h5 class="gold mb-4 text-center fw-bold"><i class="fas fa-star me-2"></i>DATOS DE VENTA</h5>
                        
                        <div class="mb-3">
                            <label>CLIENTA</label>
                            <input id="inputCliente" class="form-control" placeholder="Nombre completo">
                        </div>

                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <label>FOLIO</label>
                                <input id="inputFolio" class="form-control" readonly>
                            </div>
                            <div class="col-6">
                                <label>MÉTODO</label>
                                <select id="metodoPago" class="form-select" onchange="toggleTransferencia()">
                                    <option value="Efectivo">Efectivo</option>
                                    <option value="Transferencia">Transferencia</option>
                                    <option value="Tarjeta">Tarjeta</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label>AGREGAR SERVICIO</label>
                            <div class="input-group">
                                <select id="selectServicio" class="form-select"></select>
                                <button class="btn btn-gold" onclick="agregarAlCarrito('servicio')"><i class="fas fa-plus"></i></button>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label>AGREGAR EXTRA / MATERIAL</label>
                            <div class="input-group">
                                <select id="selectMaterial" class="form-select"></select>
                                <button class="btn btn-gold" style="filter: contrast(0.8);" onclick="agregarAlCarrito('material')"><i class="fas fa-plus"></i></button>
                            </div>
                        </div>

                        <div id="infoTransferencia" class="alert alert-dark border-warning d-none small text-center">
                            <strong class="gold">PAGO TRANSFERENCIA</strong><br>
                            Banco Azteca | 1271 8001 2784 5963 25
                        </div>

                        <div class="bg-calculadora mb-4">
                            <div class="row g-2">
                                <div class="col-6">
                                    <label class="small golden-rose">DESCUENTO $</label>
                                    <input id="inputDescuento" type="number" class="form-control mb-2" value="0" oninput="renderCarrito()">
                                </div>
                                <div class="col-6">
                                    <label class="small golden-rose">PROPINA $</label>
                                    <input id="inputPropina" type="number" class="form-control mb-2" value="0" oninput="renderCarrito()">
                                </div>
                            </div>
                            <label class="small golden-rose fw-bold">CALCULAR CAMBIO</label>
                            <input id="pagaCon" type="number" class="form-control mb-2" placeholder="Paga con..." oninput="calcularCambio()">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Cambio:</span>
                                <h4 class="m-0 text-success fw-bold" id="cambioResult">$0.00</h4>
                            </div>
                        </div>

                        <button class="btn btn-gold w-100 py-3 shadow" onclick="confirmarFinalizarVenta()">
                            <i class="fas fa-check-circle me-2"></i> REGISTRAR Y TICKET
                        </button>
                    </div>
                </div>

                <div class="col-xl-8">
                    <div class="card p-4 mb-4 animate__animated animate__fadeInRight" style="min-height: 500px; display: flex; flex-direction: column;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="gold fw-bold m-0"><i class="fas fa-receipt me-2"></i>RESUMEN DE COBRO</h5>
                            <button class="btn btn-sm btn-outline-danger" onclick="limpiarCarrito()">VACIAR</button>
                        </div>

                        <div class="table-responsive flex-grow-1">
                            <table class="table table-dark table-hover align-middle">
                                <thead class="text-secondary small">
                                    <tr>
                                        <th>CONCEPTO</th>
                                        <th>TIPO</th>
                                        <th>PRECIO</th>
                                        <th class="text-end">ACCIÓN</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaCarrito"></tbody>
                            </table>
                        </div>

                        <div class="mt-3 bg-dark p-3 rounded border border-warning">
                            <div class="d-flex justify-content-between mb-1 small">
                                <span class="text-secondary">Subtotal:</span>
                                <span id="subtotalLabel">$0.00</span>
                            </div>
                            <div class="d-flex justify-content-between mb-1 small">
                                <span class="text-danger">Descuento:</span>
                                <span id="descuentoLabel">-$0.00</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2 small">
                                <span class="text-info">Propina:</span>
                                <span id="propinaLabel">+$0.00</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <h2 class="golden-rose fw-bold m-0">TOTAL:</h2>
                                <h2 class="gold fw-bold m-0">$<span id="displayTotal">0.00</span></h2>
                            </div>
                        </div>
                    </div>

                    <div class="card p-3 border-secondary">
                        <h6 class="gold fw-bold mb-3 small"><i class="fas fa-history me-2"></i>ÚLTIMAS VENTAS DEL DÍA</h6>
                        <div id="historialRapido" class="row g-2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalTicket" tabindex="-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content ticket-modal shadow-lg" id="ticketPrint">
                <div class="text-center">
                    <h5 class="fw-bold m-0">LK STUDIO</h5>
                    <small>ELITE NAILS & HAIR</small>
                    <hr>
                </div>
                <div class="small">
                    <p class="mb-1"><strong>Folio:</strong> <span id="tFolio"></span></p>
                    <p class="mb-1"><strong>Fecha:</strong> <span id="tFecha"></span></p>
                    <p class="mb-3"><strong>Clienta:</strong> <span id="tCliente"></span></p>
                    <div id="tConceptos" class="mb-3"></div>
                    <hr>
                    <div class="d-flex justify-content-between">
                        <strong>TOTAL:</strong>
                        <strong id="tTotal"></strong>
                    </div>
                    <p class="small text-center mt-4">¡Gracias por tu preferencia!</p>
                </div>
                <button class="btn btn-dark btn-sm w-100 mt-3 no-print" onclick="window.print()">Imprimir Ticket</button>
            </div>
        </div>
    </div>

<script>
// --- DATOS ---
const serviciosPredefinidos = [
    {nombre:"Corte Mariposa", precio:150},
    {nombre:"Uñas Acrílicas #2", precio:350},
    {nombre:"Balayage Elite", precio:2500},
    {nombre:"Maquillaje Novia", precio:1200}
];

const materiales = [
    {nombre:"Piedras Swarovski", precio:100},
    {nombre:"Efecto Espejo", precio:50},
    {nombre:"Diseño 3D", precio:150},
    {nombre:"Retiro de Material", precio:100}
];

let carrito = [];

// --- INICIO ---
document.addEventListener('DOMContentLoaded', () => {
    // Intentar cargar servicios desde el Catálogo real
    const serviciosGuardados = JSON.parse(localStorage.getItem("servicios")) || serviciosPredefinidos;
    
    const selS = document.getElementById("selectServicio");
    serviciosGuardados.forEach((s, i) => {
        selS.innerHTML += `<option value="${i}">${s.nombre} ($${s.precio})</option>`;
    });

    const selM = document.getElementById("selectMaterial");
    materiales.forEach((m, i) => {
        selM.innerHTML += `<option value="${i}">${m.nombre} ($${m.precio})</option>`;
    });

    document.getElementById("fecha-actual").innerText = new Date().toLocaleDateString('es-MX', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    
    generarFolio();
    actualizarHistorial();
});

function generarFolio() {
    const ultimoFolio = localStorage.getItem("ultimo_folio") || 100;
    const nuevoFolio = parseInt(ultimoFolio) + 1;
    document.getElementById("inputFolio").value = "LK-" + nuevoFolio;
}

function agregarAlCarrito(tipo) {
    const serviciosGuardados = JSON.parse(localStorage.getItem("servicios")) || serviciosPredefinidos;
    const id = (tipo === 'servicio') ? document.getElementById("selectServicio").value : document.getElementById("selectMaterial").value;
    const item = (tipo === 'servicio') ? serviciosGuardados[id] : materiales[id];
    
    carrito.push({ 
        tipo: tipo === 'servicio' ? 'Servicio' : 'Extra', 
        desc: item.nombre || item.name, 
        precio: parseFloat(item.precio) 
    });
    renderCarrito();
}

function eliminarItem(index) {
    carrito.splice(index, 1);
    renderCarrito();
}

function limpiarCarrito() {
    if(carrito.length > 0 && confirm("¿Deseas vaciar el resumen actual?")) {
        carrito = [];
        renderCarrito();
    }
}

function renderCarrito() {
    const tbody = document.getElementById("tablaCarrito");
    tbody.innerHTML = "";
    let subtotal = 0;

    carrito.forEach((item, i) => {
        subtotal += item.precio;
        tbody.innerHTML += `
            <tr class="animate__animated animate__fadeIn">
                <td class="small">${item.desc}</td>
                <td><span class="badge ${item.tipo === 'Servicio' ? 'badge-servicio' : 'badge-extra'}">${item.tipo}</span></td>
                <td class="gold fw-bold">$${item.precio.toFixed(2)}</td>
                <td class="text-end">
                    <button class="btn btn-sm text-danger" onclick="eliminarItem(${i})"><i class="fas fa-trash"></i></button>
                </td>
            </tr>`;
    });

    const desc = parseFloat(document.getElementById("inputDescuento").value) || 0;
    const prop = parseFloat(document.getElementById("inputPropina").value) || 0;
    const total = (subtotal - desc) + prop;

    document.getElementById("subtotalLabel").innerText = `$${subtotal.toFixed(2)}`;
    document.getElementById("descuentoLabel").innerText = `-$${desc.toFixed(2)}`;
    document.getElementById("propinaLabel").innerText = `+$${prop.toFixed(2)}`;
    document.getElementById("displayTotal").innerText = total.toFixed(2);
    
    calcularCambio();
}

function calcularCambio() {
    const total = parseFloat(document.getElementById("displayTotal").innerText);
    const paga = parseFloat(document.getElementById("pagaCon").value) || 0;
    const cambio = paga - total;
    const res = document.getElementById("cambioResult");
    res.innerText = `$${(cambio > 0 ? cambio : 0).toFixed(2)}`;
    res.className = cambio >= 0 ? "m-0 text-success fw-bold" : "m-0 text-danger fw-bold";
}

function toggleTransferencia() {
    const m = document.getElementById("metodoPago").value;
    document.getElementById("infoTransferencia").classList.toggle("d-none", m !== "Transferencia");
}

function confirmarFinalizarVenta() {
    const cliente = document.getElementById("inputCliente").value;
    if(!cliente) return alert("Por favor, ingresa el nombre de la clienta.");
    if(carrito.length === 0) return alert("El carrito está vacío.");

    const total = document.getElementById("displayTotal").innerText;
    
    // Preparar Ticket
    document.getElementById("tFolio").innerText = document.getElementById("inputFolio").value;
    document.getElementById("tFecha").innerText = new Date().toLocaleString();
    document.getElementById("tCliente").innerText = cliente;
    document.getElementById("tTotal").innerText = "$" + total;
    
    let htmlConceptos = "";
    carrito.forEach(item => {
        htmlConceptos += `<div class="d-flex justify-content-between small"><span>${item.desc}</span><span>$${item.precio}</span></div>`;
    });
    document.getElementById("tConceptos").innerHTML = htmlConceptos;

    // Guardar en base de datos local
    const venta = {
        folio: document.getElementById("inputFolio").value,
        cliente,
        total,
        metodo: document.getElementById("metodoPago").value,
        hora: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
    };

    let ventas = JSON.parse(localStorage.getItem("ventas_dia")) || [];
    ventas.unshift(venta);
    localStorage.setItem("ventas_dia", JSON.stringify(ventas));
    localStorage.setItem("ultimo_folio", venta.folio.replace("LK-", ""));

    // Mostrar Ticket y limpiar al cerrar
    const myModal = new bootstrap.Modal(document.getElementById('modalTicket'));
    myModal.show();
    
    // Reiniciar POS tras un pequeño delay o al cerrar modal
    document.getElementById('modalTicket').addEventListener('hidden.bs.modal', function () {
        location.reload();
    });
}

function actualizarHistorial() {
    const ventas = JSON.parse(localStorage.getItem("ventas_dia")) || [];
    const div = document.getElementById("historialRapido");
    const cajaHoy = document.getElementById("cajaHoy");
    const numVentas = document.getElementById("numVentas");
    
    let sumaTotal = 0;
    div.innerHTML = "";
    
    ventas.forEach((v, i) => {
        sumaTotal += parseFloat(v.total);
        if(i < 4) { // Solo mostrar las últimas 4 en el dashboard
            div.innerHTML += `
                <div class="col-6 col-md-3">
                    <div class="p-2 historial-item rounded text-center small animate__animated animate__fadeIn">
                        <div class="gold fw-bold">$${v.total}</div>
                        <div class="text-white text-truncate">${v.cliente}</div>
                        <div class="golden-rose" style="font-size:10px">${v.hora} | ${v.metodo}</div>
                    </div>
                </div>`;
        }
    });
    
    cajaHoy.innerText = `$${sumaTotal.toFixed(2)}`;
    numVentas.innerText = ventas.length;
}

function verCorteCaja() {
    const ventas = JSON.parse(localStorage.getItem("ventas_dia")) || [];
    let efectivo = 0, tarjeta = 0, trans = 0;
    
    ventas.forEach(v => {
        if(v.metodo === "Efectivo") efectivo += parseFloat(v.total);
        if(v.metodo === "Tarjeta") tarjeta += parseFloat(v.total);
        if(v.metodo === "Transferencia") trans += parseFloat(v.total);
    });

    alert(`CORTE DE CAJA LK STUDIO\n\n` +
          `Efectivo: $${efectivo.toFixed(2)}\n` +
          `Tarjeta: $${tarjeta.toFixed(2)}\n` +
          `Transferencia: $${trans.toFixed(2)}\n\n` +
          `TOTAL ACUMULADO: $${(efectivo+tarjeta+trans).toFixed(2)}`);
}
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
