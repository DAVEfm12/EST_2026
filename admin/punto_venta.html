<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Punto de Venta | Belleza & Nails</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <style>
        body {
            background: linear-gradient(135deg, #0f0f0f, #1a1a1a);
            color: #fff;
            min-height: 100vh;
        }
        .card {
            background: #000;
            border: 2px solid #D4AF37;
            border-radius: 1rem;
        }
        .gold { color: #D4AF37; }
        .rose { color: #e6b8a2; }
        .btn-gold {
            background: #D4AF37;
            color: #000;
            font-weight: bold;
        }
        .btn-gold:hover { background: #bfa233; color: #000; }
        .table-dark { --bs-table-bg: transparent; }
        .badge-servicio { background-color: #D4AF37; color: #000; }
        .badge-material { background-color: #17a2b8; color: #fff; }
        .badge-extra { background-color: #dc3545; color: #fff; }
    </style>
</head>

<body>
<div class="container py-5">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <a href="PANEL_ADMIN.html" class="btn btn-outline-light">
            <i class="fas fa-arrow-left"></i> Volver
        </a>
        <h1 class="gold fw-bold m-0"><i class="fas fa-cash-register"></i> Punto de Venta</h1>
        <div class="text-end">
            <span id="fecha-actual" class="rose"></span>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-4">
            <div class="card p-4">
                <h5 class="gold mb-3"><i class="fas fa-receipt"></i> Registro de Cobro</h5>

                <div class="mb-3">
                    <label class="rose form-label small">Cliente</label>
                    <input id="inputCliente" class="form-control" placeholder="Nombre del cliente">
                </div>

                <div class="mb-3">
                    <label class="rose form-label small">Folio Cita</label>
                    <input id="inputCita" class="form-control" placeholder="CITA-000">
                </div>

                <hr class="border-secondary">

                <label class="rose form-label small">Seleccionar Servicio</label>
                <div class="input-group mb-3">
                    <select id="selectServicio" class="form-select"></select>
                    <button class="btn btn-gold" onclick="agregarServicio()">+</button>
                </div>

                <label class="rose form-label small">Material Adicional</label>
                <div class="input-group mb-3">
                    <select id="selectMaterial" class="form-select"></select>
                    <button class="btn btn-outline-info" onclick="agregarMaterial()">+</button>
                </div>

                <hr class="border-secondary">

                <h6 class="rose small mb-2">Cobro Extra Específico</h6>
                <input id="extraDesc" class="form-control mb-2 form-control-sm" placeholder="Concepto (ej. Piedras extra)">
                <div class="input-group mb-3">
                    <span class="input-group-text bg-dark text-white border-secondary">$</span>
                    <input id="extraMonto" type="number" class="form-control form-control-sm" placeholder="0.00">
                    <button class="btn btn-outline-danger btn-sm" onclick="agregarExtra()">Añadir</button>
                </div>

                <hr class="border-secondary">

                <label class="rose form-label small">Método de Pago</label>
                <select id="metodoPago" class="form-select mb-3" onchange="toggleTransferencia()">
                    <option value="Efectivo">Efectivo</option>
                    <option value="Transferencia">Transferencia</option>
                    <option value="Tarjeta">Tarjeta</option>
                </select>

                <div id="infoTransferencia" class="alert alert-secondary d-none small">
                    <strong>Banco Azteca</strong><br>
                    CLABE: 127180012784596325
                </div>

                <button class="btn btn-success w-100 fw-bold" onclick="finalizarVenta()">
                    <i class="fas fa-check-circle"></i> REGISTRAR Y COBRAR
                </button>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="card p-4 mb-4">
                <h5 class="gold mb-3"><i class="fas fa-shopping-cart"></i> Detalle del Cobro Actual</h5>
                <div class="table-responsive" style="min-height: 200px;">
                    <table class="table table-dark">
                        <thead>
                            <tr class="rose small">
                                <th>Tipo</th>
                                <th>Concepto</th>
                                <th>Precio</th>
                                <th class="text-end">Acción</th>
                            </tr>
                        </thead>
                        <tbody id="tablaCarrito"></tbody>
                    </table>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-3 border-top pt-3">
                    <h3 class="gold m-0">TOTAL: $<span id="displayTotal">0</span></h3>
                    <button class="btn btn-sm btn-outline-secondary" onclick="vaciarCarrito()">Limpiar Carrito</button>
                </div>
            </div>

            <div class="card p-4">
                <h5 class="rose mb-3 small"><i class="fas fa-history"></i> Últimos Movimientos del Día</h5>
                <div class="table-responsive">
                    <table class="table table-dark table-sm small">
                        <thead>
                            <tr class="text-white-50">
                                <th>Cita</th>
                                <th>Cliente</th>
                                <th>Total</th>
                                <th>Pago</th>
                                <th>Hora</th>
                            </tr>
                        </thead>
                        <tbody id="tablaHistorial"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// --- DATOS ---
const servicios = [
    {name:"Corte Mariposa", precio:150},
    {name:"Corte Bob", precio:150},
    {name:"Balayage", precio:2000},
    {name:"Uñas Acrílicas #2", precio:350},
    {name:"Uñas Acrílicas XXL", precio:700},
    {name:"Pedicura Spa VIP", precio:1500}
];

const materiales = [
    {name:"Guantes desechables", precio:5},
    {name:"Lima desechable", precio:20},
    {name:"Gel color", precio:50},
    {name:"Cristal Swarovski", precio:10},
    {name:"Diseño mano alzada", precio:45}
];

let carrito = [];

// --- INICIALIZACIÓN ---
document.addEventListener('DOMContentLoaded', () => {
    const selS = document.getElementById("selectServicio");
    servicios.forEach((s, i) => selS.innerHTML += `<option value="${i}">${s.name} ($${s.precio})</option>`);

    const selM = document.getElementById("selectMaterial");
    materiales.forEach((m, i) => selM.innerHTML += `<option value="${i}">${m.name} ($${m.precio})</option>`);

    document.getElementById("fecha-actual").innerText = new Date().toLocaleDateString();
    actualizarHistorial();
});

// --- FUNCIONES LÓGICAS ---

function agregarServicio() {
    const item = servicios[document.getElementById("selectServicio").value];
    carrito.push({ tipo: "Servicio", desc: item.name, precio: item.precio });
    renderCarrito();
}

function agregarMaterial() {
    const item = materiales[document.getElementById("selectMaterial").value];
    carrito.push({ tipo: "Material", desc: item.name, precio: item.precio });
    renderCarrito();
}

function agregarExtra() {
    const d = document.getElementById("extraDesc").value;
    const m = parseFloat(document.getElementById("extraMonto").value);
    
    if(!d || isNaN(m)) return alert("Escribe descripción y monto del extra");
    
    carrito.push({ tipo: "Extra", desc: d, precio: m });
    document.getElementById("extraDesc").value = "";
    document.getElementById("extraMonto").value = "";
    renderCarrito();
}

function eliminarItem(index) {
    carrito.splice(index, 1);
    renderCarrito();
}

function renderCarrito() {
    const tbody = document.getElementById("tablaCarrito");
    const displayTotal = document.getElementById("displayTotal");
    tbody.innerHTML = "";
    let total = 0;

    carrito.forEach((item, i) => {
        total += item.precio;
        let badgeClass = item.tipo === "Servicio" ? "badge-servicio" : (item.tipo === "Material" ? "badge-material" : "badge-extra");
        
        tbody.innerHTML += `
            <tr>
                <td><span class="badge ${badgeClass}">${item.tipo}</span></td>
                <td>${item.desc}</td>
                <td class="gold">$${item.precio}</td>
                <td class="text-end">
                    <button class="btn btn-sm text-danger" onclick="eliminarItem(${i})"><i class="fas fa-times"></i></button>
                </td>
            </tr>
        `;
    });
    displayTotal.innerText = total;
}

function vaciarCarrito() {
    carrito = [];
    renderCarrito();
}

function toggleTransferencia() {
    const m = document.getElementById("metodoPago").value;
    document.getElementById("infoTransferencia").classList.toggle("d-none", m !== "Transferencia");
}

function finalizarVenta() {
    const cliente = document.getElementById("inputCliente").value;
    if(!cliente || carrito.length === 0) return alert("Ingresa el cliente y al menos un concepto");

    const total = carrito.reduce((acc, obj) => acc + obj.precio, 0);
    const nuevaVenta = {
        cita: document.getElementById("inputCita").value || "N/A",
        cliente: cliente,
        total: total,
        pago: document.getElementById("metodoPago").value,
        hora: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
    };

    // Guardar en LocalStorage
    let ventas = JSON.parse(localStorage.getItem("ventas_dia")) || [];
    ventas.unshift(nuevaVenta);
    localStorage.setItem("ventas_dia", JSON.stringify(ventas));

    // Resetear formulario
    vaciarCarrito();
    document.getElementById("inputCliente").value = "";
    document.getElementById("inputCita").value = "";
    actualizarHistorial();
    alert("¡Venta registrada con éxito!");
}

function actualizarHistorial() {
    const ventas = JSON.parse(localStorage.getItem("ventas_dia")) || [];
    const tbody = document.getElementById("tablaHistorial");
    tbody.innerHTML = "";
    
    ventas.slice(0, 5).forEach(v => { // Mostrar solo las últimas 5
        tbody.innerHTML += `
            <tr>
                <td>${v.cita}</td>
                <td>${v.cliente}</td>
                <td class="gold">$${v.total}</td>
                <td>${v.pago}</td>
                <td>${v.hora}</td>
            </tr>
        `;
    });
}
</script>
</body>
</html>
