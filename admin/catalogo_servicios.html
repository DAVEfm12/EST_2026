<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Catálogo de Servicios | LK Studio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

  <style>
    :root {
      --gold: #D4AF37;
      --gold-bright: #FFD700;
      --golden-rose: #e6b8a2;
      --deep-black: #050505;
      --sidebar-width: 250px;
    }

    body {
      background: radial-gradient(circle at top, #1a1a1a, var(--deep-black));
      color: #ffffff;
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      margin: 0;
      display: flex;
    }

    /* --- SIDEBAR --- */
    #sidebar {
      width: var(--sidebar-width);
      background: rgba(0, 0, 0, 0.95);
      border-right: 1px solid var(--gold);
      height: 100vh;
      position: fixed;
      z-index: 1000;
    }

    .sidebar-header {
      padding: 30px 20px;
      text-align: center;
      border-bottom: 1px solid rgba(212, 175, 55, 0.2);
    }

    .nav-link {
      color: #fff !important;
      padding: 15px 25px;
      display: flex;
      align-items: center;
      transition: 0.3s;
      border-left: 3px solid transparent;
      font-size: 0.9rem;
      text-decoration: none;
    }

    .nav-link i { margin-right: 15px; width: 20px; text-align: center; color: var(--gold); }

    .nav-link:hover, .nav-link.active {
      background: rgba(212, 175, 55, 0.1);
      border-left: 3px solid var(--gold);
      color: var(--gold-bright) !important;
    }

    /* --- CONTENIDO --- */
    #content {
      width: calc(100% - var(--sidebar-width));
      margin-left: var(--sidebar-width);
      padding: 40px;
    }

    .service-card {
      background: rgba(10, 10, 10, 0.9);
      border: 1px solid var(--gold);
      border-radius: 1.5rem;
      transition: 0.3s;
      height: 100%;
      overflow: hidden;
    }

    .service-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 10px 30px rgba(212, 175, 55, 0.15);
    }

    .service-img-top {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-bottom: 1px solid var(--gold);
    }

    .badge-category {
      background: var(--gold);
      color: #000;
      font-size: 0.7rem;
      font-weight: bold;
      text-transform: uppercase;
    }

    /* Previsualización de Imagen */
    #previewImg {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 10px;
      border: 1px dashed var(--gold);
      margin-top: 10px;
      display: none;
    }

    .modal-content {
      background: var(--deep-black);
      border: 2px solid var(--gold);
      border-radius: 1.5rem;
    }

    .form-control, .form-select {
      background: #000 !important;
      border: 1px solid #444 !important;
      color: #fff !important;
    }

    .btn-gold {
      background: linear-gradient(45deg, var(--gold), #f3cf58);
      color: #000 !important;
      font-weight: bold;
      border: none;
      border-radius: 10px;
    }

    .stats-box {
      background: rgba(212, 175, 55, 0.05);
      border: 1px solid #333;
      padding: 15px;
      border-radius: 15px;
      text-align: center;
    }

    .btn-add-cat {
        background: var(--gold);
        border: none;
        color: black;
    }
  </style>
</head>

<body>

  <nav id="sidebar">
    <div class="sidebar-header">
      <h4 class="fw-bold mb-0" style="color:var(--gold)">LK STUDIO</h4>
      <small style="color:var(--golden-rose)">ADMINISTRACIÓN</small>
    </div>
    <div class="mt-4">
      <a href="POS.html" class="nav-link"><i class="fas fa-cash-register"></i> VENTAS (POS)</a>
      <a href="#" class="nav-link active"><i class="fas fa-list"></i> SERVICIOS</a>
      <a href="./catalogo_cursos.html" class="nav-link"><i class="fas fa-graduation-cap"></i> CURSOS</a>
      <a href="./PANEL_ADMIN.html" class="nav-link"><i class="fas fa-arrow-left"></i> VOLVER AL PANEL</a>
    </div>
  </nav>

  <div id="content">
    <div class="container-fluid">
      
      <div class="row mb-5 align-items-center">
        <div class="col-md-6">
          <h1 class="fw-bold animate__animated animate__fadeInDown" style="color:var(--gold)">Catálogo Elite</h1>
          <p style="color:var(--golden-rose)">Gestión de servicios y precios premium</p>
        </div>
        <div class="col-md-3">
          <div class="stats-box">
            <small class="text-white opacity-50">TOTAL SERVICIOS</small>
            <h3 id="countServicios" class="m-0 text-gold">0</h3>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-box border-warning">
            <small class="text-white opacity-50">VALOR PROMEDIO</small>
            <h3 id="avgPrecio" class="m-0 text-gold">$0</h3>
          </div>
        </div>
      </div>

      <div class="row mb-4 g-3">
        <div class="col-md-4">
          <div class="input-group">
            <span class="input-group-text bg-dark border-secondary"><i class="fas fa-search text-warning"></i></span>
            <input type="text" id="buscador" class="form-control" placeholder="Buscar servicio..." onkeyup="filtrarServicios()">
          </div>
        </div>
        <div class="col-md-3">
          <select id="filtroCategoria" class="form-select" onchange="filtrarServicios()">
            <option value="Todos">Todas las categorías</option>
          </select>
        </div>
        <div class="col-md-5 text-end">
          <button class="btn btn-gold px-4" data-bs-toggle="modal" data-bs-target="#modalServicio" onclick="limpiarFormulario()">
            <i class="fas fa-plus-circle me-2"></i> NUEVO SERVICIO
          </button>
        </div>
      </div>

      <div class="row g-4" id="listaServicios"></div>
    </div>
  </div>

  <div class="modal fade" id="modalServicio" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-3">
        <div class="modal-header border-0">
          <h5 class="modal-title fw-bold" style="color:var(--gold)" id="modalTitulo">Nuevo Servicio</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="servicioId">
          
          <div class="mb-3">
            <label class="form-label" style="color:var(--golden-rose)">Imagen del Servicio</label>
            <input type="file" id="fotoInput" class="form-control" accept="image/*">
            <img id="previewImg" src="#" alt="Vista previa">
          </div>

          <div class="mb-3">
            <label class="form-label" style="color:var(--golden-rose)">Nombre del Servicio</label>
            <input class="form-control" id="nombre" placeholder="Ej. Retoque Acrílico">
          </div>

          <div class="row">
            <div class="col-md-7 mb-3">
              <label class="form-label" style="color:var(--golden-rose)">Categoría</label>
              <div class="input-group">
                <select id="categoria" class="form-select"></select>
                <button class="btn btn-add-cat" type="button" onclick="agregarNuevaCategoria()">
                    <i class="fas fa-plus"></i>
                </button>
              </div>
            </div>
            <div class="col-md-5 mb-3">
              <label class="form-label" style="color:var(--golden-rose)">Precio ($)</label>
              <input type="number" class="form-control" id="precio" placeholder="0.00">
            </div>
          </div>
          
          <div class="mb-3">
            <label class="form-label" style="color:var(--golden-rose)">Descripción Corta</label>
            <textarea class="form-control" id="descripcion" rows="2"></textarea>
          </div>
        </div>
        <div class="modal-footer border-0">
          <button class="btn btn-gold w-100 py-2" onclick="guardarServicio()">GUARDAR EN CATÁLOGO</button>
        </div>
      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
let servicios = JSON.parse(localStorage.getItem("servicios")) || [];
let categorias = JSON.parse(localStorage.getItem("LK_CAT_SERVICIOS")) || ["UÑAS", "CABELLO", "MAQUILLAJE", "PESTAÑAS"];
let base64Image = "";
let editando = false;

// --- GESTIÓN DE CATEGORÍAS ---
function actualizarSelects() {
    const selects = [document.getElementById("categoria"), document.getElementById("filtroCategoria")];
    
    // Select del modal
    selects[0].innerHTML = categorias.map(c => `<option value="${c}">${c}</option>`).join('');
    
    // Select de filtro (con opción "Todos")
    selects[1].innerHTML = `<option value="Todos">Todas las categorías</option>` + 
                           categorias.map(c => `<option value="${c}">${c}</option>`).join('');
}

function agregarNuevaCategoria() {
    const nueva = prompt("Nombre de la nueva categoría:").toUpperCase();
    if (nueva && !categorias.includes(nueva)) {
        categorias.push(nueva);
        localStorage.setItem("LK_CAT_SERVICIOS", JSON.stringify(categorias));
        actualizarSelects();
        document.getElementById("categoria").value = nueva;
    }
}

// --- LÓGICA DE IMAGEN ---
document.getElementById('fotoInput').addEventListener('change', function(e) {
    const reader = new FileReader();
    const preview = document.getElementById("previewImg");
    
    reader.onload = function() {
        base64Image = reader.result;
        preview.src = reader.result;
        preview.style.display = "block";
    };
    
    if(e.target.files[0]) reader.readAsDataURL(e.target.files[0]);
});

// --- CRUD SERVICIOS ---
function renderServicios(datos = servicios) {
  const contenedor = document.getElementById("listaServicios");
  contenedor.innerHTML = "";
  let totalPrecios = 0;

  datos.forEach((s, index) => {
    totalPrecios += parseFloat(s.precio);
    const imgUrl = s.foto || 'https://via.placeholder.com/300x150?text=SIN+IMAGEN';
    
    contenedor.innerHTML += `
      <div class="col-md-6 col-lg-4 animate__animated animate__fadeInUp">
        <div class="service-card">
          <img src="${imgUrl}" class="service-img-top">
          <div class="p-4">
              <div class="d-flex justify-content-between mb-2">
                <span class="badge badge-category">${s.categoria}</span>
                <span class="text-gold fw-bold">ID: #${s.id.toString().slice(-4)}</span>
              </div>
              <h4 class="fw-bold text-white mb-1">${s.nombre}</h4>
              <p class="small text-white opacity-50 mb-3" style="height: 40px; overflow: hidden;">${s.descripcion}</p>
              <div class="d-flex justify-content-between align-items-center">
                <h3 class="text-gold fw-bold m-0">$${s.precio}</h3>
                <div class="btn-group">
                  <button class="btn btn-sm btn-outline-warning" onclick="editarServicio(${s.id})"><i class="fas fa-edit"></i></button>
                  <button class="btn btn-sm btn-outline-danger" onclick="eliminarServicio(${s.id})"><i class="fas fa-trash"></i></button>
                </div>
              </div>
          </div>
        </div>
      </div>`;
  });

  document.getElementById("countServicios").innerText = datos.length;
  const avg = datos.length ? (totalPrecios / datos.length).toFixed(0) : 0;
  document.getElementById("avgPrecio").innerText = `$${avg}`;
}

function guardarServicio() {
  const nombre = document.getElementById("nombre").value.toUpperCase();
  const categoria = document.getElementById("categoria").value;
  const precio = document.getElementById("precio").value;
  const descripcion = document.getElementById("descripcion").value;
  const id = document.getElementById("servicioId").value;

  if (!nombre || !precio) return alert("Completa nombre y precio.");

  const datosServicio = { 
    id: editando ? Number(id) : Date.now(), 
    nombre, 
    categoria, 
    descripcion, 
    precio,
    foto: base64Image
  };

  if (editando) {
    const index = servicios.findIndex(s => s.id == id);
    // Si no subió foto nueva, conservar la anterior
    if(!base64Image) datosServicio.foto = servicios[index].foto;
    servicios[index] = datosServicio;
  } else {
    servicios.push(datosServicio);
  }

  localStorage.setItem("servicios", JSON.stringify(servicios));
  bootstrap.Modal.getInstance(document.getElementById("modalServicio")).hide();
  renderServicios();
}

function editarServicio(id) {
  const s = servicios.find(s => s.id === id);
  editando = true;
  document.getElementById("modalTitulo").innerText = "Editar Servicio";
  document.getElementById("servicioId").value = s.id;
  document.getElementById("nombre").value = s.nombre;
  document.getElementById("categoria").value = s.categoria;
  document.getElementById("precio").value = s.precio;
  document.getElementById("descripcion").value = s.descripcion;
  
  if(s.foto) {
      document.getElementById("previewImg").src = s.foto;
      document.getElementById("previewImg").style.display = "block";
      base64Image = s.foto;
  }
  
  new bootstrap.Modal(document.getElementById("modalServicio")).show();
}

function filtrarServicios() {
  const busqueda = document.getElementById("buscador").value.toLowerCase();
  const cat = document.getElementById("filtroCategoria").value;

  const filtrados = servicios.filter(s => {
    const coincideNombre = s.nombre.toLowerCase().includes(busqueda);
    const coincideCat = (cat === "Todos" || s.categoria === cat);
    return coincideNombre && coincideCat;
  });

  renderServicios(filtrados);
}

function eliminarServicio(id) {
  if (confirm("¿Eliminar este servicio?")) {
    servicios = servicios.filter(s => s.id !== id);
    localStorage.setItem("servicios", JSON.stringify(servicios));
    renderServicios();
  }
}

function limpiarFormulario() {
  editando = false;
  base64Image = "";
  document.getElementById("modalTitulo").innerText = "Nuevo Servicio";
  document.getElementById("nombre").value = "";
  document.getElementById("precio").value = "";
  document.getElementById("descripcion").value = "";
  document.getElementById("previewImg").style.display = "none";
  document.getElementById("fotoInput").value = "";
}

// Inicializar
actualizarSelects();
renderServicios();
</script>

</body>
</html>
