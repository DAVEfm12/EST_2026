<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Catálogo de Servicios | LK Studio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --gold: #D4AF37;
      --gold-bright: #FFD700;
      --golden-rose: #e6b8a2;
      --deep-black: #050505;
      --sidebar-width: 250px;
    }

    body {
      background: radial-gradient(circle at top, #1a1a1a, var(--deep-black));
      color: #ffffff;
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      margin: 0;
      display: flex;
    }

    #sidebar {
      width: var(--sidebar-width);
      background: rgba(0, 0, 0, 0.95);
      border-right: 1px solid var(--gold);
      height: 100vh;
      position: fixed;
      z-index: 1000;
    }

    .sidebar-header {
      padding: 30px 20px;
      text-align: center;
      border-bottom: 1px solid rgba(212, 175, 55, 0.2);
    }

    .nav-link {
      color: #fff !important;
      padding: 15px 25px;
      display: flex;
      align-items: center;
      transition: 0.3s;
      border-left: 3px solid transparent;
      font-size: 0.9rem;
      text-decoration: none;
    }

    .nav-link i { margin-right: 15px; width: 20px; text-align: center; color: var(--gold); }

    .nav-link:hover, .nav-link.active {
      background: rgba(212, 175, 55, 0.1);
      border-left: 3px solid var(--gold);
      color: var(--gold-bright) !important;
    }

    #content {
      width: calc(100% - var(--sidebar-width));
      margin-left: var(--sidebar-width);
      padding: 40px;
    }

    .service-card {
      background: rgba(15, 15, 15, 0.95);
      border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 1.5rem;
      transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      height: 100%;
      position: relative;
      overflow: hidden;
    }

    .service-card:hover {
      transform: translateY(-10px);
      border-color: var(--gold);
      box-shadow: 0 10px 30px rgba(212, 175, 55, 0.2);
    }

    .badge-category {
      background: var(--gold);
      color: #000;
      font-size: 0.65rem;
      padding: 5px 12px;
      border-radius: 50px;
      font-weight: 800;
      text-transform: uppercase;
    }

    .modal-content {
      background: #0a0a0a;
      border: 2px solid var(--gold);
      border-radius: 1.5rem;
      box-shadow: 0 0 50px rgba(212, 175, 55, 0.1);
    }

    .form-control, .form-select {
      background: #000 !important;
      border: 1px solid #333 !important;
      color: #fff !important;
    }

    .form-control:focus { border-color: var(--gold); box-shadow: none; }

    .btn-gold {
      background: linear-gradient(45deg, var(--gold), #f3cf58);
      color: #000 !important;
      font-weight: bold;
      border: none;
      border-radius: 10px;
      transition: 0.3s;
    }

    .btn-gold:hover { transform: scale(1.02); opacity: 0.9; }

    .stats-box {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(212, 175, 55, 0.1);
      padding: 20px;
      border-radius: 20px;
      text-align: center;
    }

    .luxury-text { font-family: 'Cinzel', serif; color: var(--gold); }
  </style>
</head>

<body>

  <nav id="sidebar">
    <div class="sidebar-header">
      <h4 class="luxury-text fw-bold mb-0">LK STUDIO</h4>
      <small style="color:var(--golden-rose); letter-spacing: 2px;">ADMINISTRACIÓN</small>
    </div>
    <div class="mt-4">
      <a href="POS.html" class="nav-link"><i class="fas fa-cash-register"></i> VENTAS (POS)</a>
      <a href="catalogo_cursos.html" class="nav-link"><i class="fas fa-graduation-cap"></i> CURSOS</a>
      <a href="catalogo_servicios.html" class="nav-link active"><i class="fas fa-list"></i> SERVICIOS</a>
      <a href="catalogo_instruc.html" class="nav-link"><i class="fas fa-user-tie"></i> INSTRUCTORES</a>
      <a href="PANEL_ADMIN.html" class="nav-link"><i class="fas fa-arrow-left"></i> VOLVER AL PANEL</a>
    </div>
  </nav>

  <div id="content">
    <div class="container-fluid">
      
      <div class="row mb-5 align-items-center">
        <div class="col-md-6">
          <h1 class="luxury-text fw-bold animate__animated animate__fadeInDown">Catálogo Elite</h1>
          <p style="color:var(--golden-rose)">Gestión de servicios y precios premium</p>
        </div>
        <div class="col-md-3">
          <div class="stats-box">
            <small class="text-white opacity-50">TOTAL SERVICIOS</small>
            <h3 id="countServicios" class="m-0 text-gold">0</h3>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-box">
            <small class="text-white opacity-50">VALOR PROMEDIO</small>
            <h3 id="avgPrecio" class="m-0 text-gold">$0</h3>
          </div>
        </div>
      </div>

      <div class="row mb-4 g-3">
        <div class="col-md-4">
          <div class="input-group">
            <span class="input-group-text bg-dark border-secondary"><i class="fas fa-search text-warning"></i></span>
            <input type="text" id="buscador" class="form-control" placeholder="Buscar servicio..." onkeyup="filtrarServicios()">
          </div>
        </div>
        <div class="col-md-3">
          <select id="filtroCategoria" class="form-select" onchange="filtrarServicios()">
            </select>
        </div>
        <div class="col-md-5 text-end">
          <button class="btn btn-outline-warning me-2" onclick="exportarServicios()">
            <i class="fas fa-download"></i> Respaldar
          </button>
          <button class="btn btn-gold px-4" data-bs-toggle="modal" data-bs-target="#modalServicio" onclick="limpiarFormulario()">
            <i class="fas fa-plus-circle me-2"></i> NUEVO SERVICIO
          </button>
        </div>
      </div>

      <div class="row g-4" id="listaServicios"></div>
    </div>
  </div>

  <div class="modal fade" id="modalServicio" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-3">
        <div class="modal-header border-0">
          <h5 class="luxury-text" id="modalTitulo">Nuevo Servicio</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="servicioId">
          <div class="mb-3">
            <label class="form-label text-warning small">NOMBRE DEL SERVICIO</label>
            <input class="form-control" id="nombre" placeholder="Ej. Retoque Acrílico">
          </div>
          <div class="row">
            <div class="col-md-8 mb-3">
              <label class="form-label text-warning small">CATEGORÍA</label>
              <div class="input-group">
                <select id="categoria" class="form-select"></select>
                <button class="btn btn-warning" onclick="nuevaCategoriaPrompt()"><i class="fas fa-plus"></i></button>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label text-warning small">PRECIO ($)</label>
              <input type="number" class="form-control" id="precio" placeholder="0">
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label text-warning small">DESCRIPCIÓN CORTA</label>
            <textarea class="form-control" id="description" rows="2"></textarea>
          </div>
        </div>
        <div class="modal-footer border-0">
          <button class="btn btn-gold w-100 py-3" onclick="guardarServicio()">GUARDAR EN CATÁLOGO</button>
        </div>
      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// LLaves de localStorage consistentas
let servicios = JSON.parse(localStorage.getItem("LK_SERVICIOS")) || [];
let categoriasServicios = JSON.parse(localStorage.getItem("LK_CAT_SERVICIOS")) || ["UÑAS", "CABELLO", "MAQUILLAJE", "PESTAÑAS"];

let editando = false;

function actualizarSelects() {
    const sFiltro = document.getElementById("filtroCategoria");
    const sModal = document.getElementById("categoria");
    
    let options = `<option value="Todos">Todas las categorías</option>`;
    let modalOptions = categoriasServicios.map(c => `<option value="${c}">${c}</option>`).join('');
    
    sFiltro.innerHTML = options + modalOptions;
    sModal.innerHTML = modalOptions;
}

function nuevaCategoriaPrompt() {
    const nombre = prompt("Nueva Categoría de Servicio:").toUpperCase();
    if (nombre && !categoriasServicios.includes(nombre)) {
        categoriasServicios.push(nombre);
        localStorage.setItem("LK_CAT_SERVICIOS", JSON.stringify(categoriasServicios));
        actualizarSelects();
        document.getElementById("categoria").value = nombre;
    }
}

function renderServicios(datos = servicios) {
  const contenedor = document.getElementById("listaServicios");
  contenedor.innerHTML = "";
  let totalPrecios = 0;

  datos.forEach((s, index) => {
    totalPrecios += parseFloat(s.precio);
    contenedor.innerHTML += `
      <div class="col-md-6 col-lg-4 animate__animated animate__fadeInUp">
        <div class="service-card p-4">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <span class="badge badge-category">${s.categoria}</span>
            <div class="btn-group">
              <button class="btn btn-sm text-white opacity-50" onclick="editarServicio(${s.id})"><i class="fas fa-edit"></i></button>
              <button class="btn btn-sm text-danger opacity-50" onclick="eliminarServicio(${s.id})"><i class="fas fa-trash"></i></button>
            </div>
          </div>
          <h4 class="fw-bold text-white mb-1 luxury-text" style="font-size:1.1rem">${s.nombre}</h4>
          <p class="small text-white opacity-50 mb-4" style="height: 40px; overflow: hidden;">${s.descripcion || 'Sin descripción'}</p>
          <div class="d-flex justify-content-between align-items-center mt-auto">
            <h3 class="text-gold fw-bold m-0">$${s.precio}</h3>
            <small class="text-muted">ID: #${String(s.id).slice(-4)}</small>
          </div>
        </div>
      </div>`;
  });

  document.getElementById("countServicios").innerText = datos.length;
  const avg = datos.length ? (totalPrecios / datos.length).toFixed(0) : 0;
  document.getElementById("avgPrecio").innerText = `$${avg}`;
}

function filtrarServicios() {
  const busqueda = document.getElementById("buscador").value.toLowerCase();
  const cat = document.getElementById("filtroCategoria").value;
  const filtrados = servicios.filter(s => {
    return s.nombre.toLowerCase().includes(busqueda) && (cat === "Todos" || s.categoria === cat);
  });
  renderServicios(filtrados);
}

function guardarServicio() {
  const nombre = document.getElementById("nombre").value.toUpperCase();
  const categoria = document.getElementById("categoria").value;
  const precio = document.getElementById("precio").value;
  const descripcion = document.getElementById("description").value;
  const id = document.getElementById("servicioId").value;

  if (!nombre || !precio) return alert("Nombre y Precio son obligatorios");

  const nuevoS = { id: editando ? Number(id) : Date.now(), nombre, categoria, descripcion, precio };

  if (editando) {
    const idx = servicios.findIndex(s => s.id == id);
    servicios[idx] = nuevoS;
  } else {
    servicios.push(nuevoS);
  }

  localStorage.setItem("LK_SERVICIOS", JSON.stringify(servicios));
  bootstrap.Modal.getInstance(document.getElementById("modalServicio")).hide();
  renderServicios();
}

function editarServicio(id) {
  const s = servicios.find(s => s.id === id);
  editando = true;
  document.getElementById("modalTitulo").innerText = "Editar Servicio";
  document.getElementById("servicioId").value = s.id;
  document.getElementById("nombre").value = s.nombre;
  document.getElementById("categoria").value = s.categoria;
  document.getElementById("precio").value = s.precio;
  document.getElementById("description").value = s.descripcion;
  new bootstrap.Modal(document.getElementById("modalServicio")).show();
}

function eliminarServicio(id) {
  if (confirm("¿Eliminar este servicio del catálogo?")) {
    servicios = servicios.filter(s => s.id !== id);
    localStorage.setItem("LK_SERVICIOS", JSON.stringify(servicios));
    renderServicios();
  }
}

function limpiarFormulario() {
  editando = false;
  document.getElementById("modalTitulo").innerText = "Nuevo Servicio";
  document.getElementById("nombre").value = "";
  document.getElementById("precio").value = "";
  document.getElementById("description").value = "";
}

function exportarServicios() {
  const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(servicios));
  const downloadAnchorNode = document.createElement('a');
  downloadAnchorNode.setAttribute("href", dataStr);
  downloadAnchorNode.setAttribute("download", "servicios_lkstudio.json");
  downloadAnchorNode.click();
}

// Inicio
actualizarSelects();
renderServicios();
</script>

</body>
</html>
